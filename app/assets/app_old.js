var app=angular.module("app",["ngRoute"]);angular.module("app").controller("ApplicationCtrl",["$scope","UserSvc","$http",function(t,o,n){localStorage.token&&(n.defaults.headers.common["X-Auth"]=localStorage.token,o.getUser().then(function(o){t.currentUser=o})),t.$on("login",function(o,n){console.log("[ApplicationCtrl] login event for:    "+n.username),t.currentUser=n}),t.logout=function(){t.currentUser=null,o.logout()}}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,o){t.login=function(n,e){o.login(n,e).then(function(o){t.$emit("login",o)})}}]),angular.module("app").controller("PostsCtrl",["$scope","PostSvc",function(t,o){t.addPost=function(){t.postBody&&o.create({body:t.postBody}).success(function(o){console.log("[posts.ctrl.js] success posting!"),t.postBody=null})},o.fetch().success(function(o){t.posts=o}),t.$on("ws:new_post",function(o,n){t.$apply(function(){t.posts.unshift(n)})})}]),angular.module("app").service("PostSvc",["$http",function(t){this.fetch=function(){return t.get("api/posts")},this.create=function(o){return t.post("api/posts",o)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(t,o){t.createUser=function(n,e){o.createUser(n,e).then(function(){return o.login(n,e)})["catch"](function(t){throw t.status+" "+t.data}).then(function(o){t.$emit("login",o.data)})}}]),angular.module("app").config(["$routeProvider","$locationProvider",function(t,o){t.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"})}]),angular.module("app").service("UserSvc",["$http",function(t){var o=this;o.createUser=function(o,n){return t.post("/api/users",{username:o,password:n})},o.getUser=function(){return t.get("/api/users").then(function(t){return t.data})},o.login=function(n,e){return t.post("/api/sessions",{username:n,password:e}).then(function(n){return localStorage.token=n.data,t.defaults.headers.common["X-Auth"]=n.data,o.getUser()})},o.logout=function(){delete t.defaults.headers.common["X-Auth"],delete localStorage.token}}]),angular.module("app").service("WebSocketSvc",["$rootScope","$timeout","$window",function(t,o,n){function e(){return"https:"===n.location.protocol?"wss://"+n.location.host:"ws://"+n.location.host}var r;this.connect=function(){console.log("Websocket connecting...");var n=e(),r=new WebSocket(n),c=this;r.onclose=function(){console.log("Websocket closed. Reconnecting..."),o(c.connect,1e4)},r.onmessage=function(o){var n=JSON.parse(o.data);t.$broadcast("ws:"+n.topic,n.data)}},this.send=function(t,o){var n=JSON.stringify({topic:t,data:o});r.send(n)}}]).run(["WebSocketSvc",function(t){t.connect()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJVc2VyU3ZjIiwiJGh0dHAiLCJsb2NhbFN0b3JhZ2UiLCJ0b2tlbiIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsImdldFVzZXIiLCJ0aGVuIiwidXNlciIsImN1cnJlbnRVc2VyIiwiJG9uIiwiXyIsImNvbnNvbGUiLCJsb2ciLCJ1c2VybmFtZSIsImxvZ291dCIsImxvZ2luIiwicGFzc3dvcmQiLCJyZXNwb25zZSIsIiRlbWl0IiwiUG9zdFN2YyIsImFkZFBvc3QiLCJwb3N0Qm9keSIsImNyZWF0ZSIsImJvZHkiLCJzdWNjZXNzIiwiZmV0Y2giLCJwb3N0cyIsInBvc3QiLCIkYXBwbHkiLCJ1bnNoaWZ0Iiwic2VydmljZSIsInRoaXMiLCJnZXQiLCJjcmVhdGVVc2VyIiwiZXJyb3IiLCJzdGF0dXMiLCJkYXRhIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInN2YyIsInZhbCIsIiRyb290U2NvcGUiLCIkdGltZW91dCIsIiR3aW5kb3ciLCJ3ZWJzb2NrZXRIb3N0IiwibG9jYXRpb24iLCJwcm90b2NvbCIsImhvc3QiLCJjb25uZWN0aW9uIiwiY29ubmVjdCIsInVybCIsIldlYlNvY2tldCIsIm9uY2xvc2UiLCJvbm1lc3NhZ2UiLCJlIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsIiRicm9hZGNhc3QiLCJ0b3BpYyIsInNlbmQiLCJqc29uIiwic3RyaW5naWZ5IiwicnVuIiwiV2ViU29ja2V0U3ZjIl0sIm1hcHBp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QUFHLFNBQUFDLFFBQUFDLE9BQUEsZ0JBQ0FKLGNBQUFDLFVDckJBUCxRQUFBQyxPQUFBLE9BQ0FtQyxRQUFBLGdCQUFBLGFBQUEsV0FBQSxVQUFBLFNBQUFjLEVBQUFDLEVBQUFDLEdBSUEsUUFBQUMsS0FDQSxNQUFBLFdBQUFELEVBQUFFLFNBQUFDLFNBQ0EsU0FBQUgsRUFBQUUsU0FBQUUsS0FFQSxRQUFBSixFQUFBRSxTQUFBRSxLQUdBLEdBQUFDLEVBQ0FwQixNQUFBcUIsUUFBQSxXQUVBekMsUUFBQUMsSUFBQSwwQkFDQSxJQUFBeUMsR0FBQU4sSUFDQUksRUFBQSxHQUFBRyxXQUFBRCxHQUNBWCxFQUFBWCxJQUNBb0IsR0FBQUksUUFBQSxXQUdBNUMsUUFBQUMsSUFBQSxxQ0FDQWlDLEVBQUFILEVBQUFVLFFBQUEsTUFFQUQsRUFBQUssVUFBQSxTQUFBQyxHQUNBLEdBQUFDLEdBQUFDLEtBQUFDLE1BQUFILEVBQUFyQixLQUNBUSxHQUFBaUIsV0FBQSxNQUFBSCxFQUFBSSxNQUFBSixFQUFBdEIsUUFTQUwsS0FBQWdDLEtBQUEsU0FBQUQsRUFBQTFCLEdBQ0EsR0FBQTRCLEdBQUFMLEtBQUFNLFdBQUFILE1BQUFBLEVBQUExQixLQUFBQSxHQUNBZSxHQUFBWSxLQUFBQyxPQUVBRSxLQUFBLGVBQUEsU0FBQUMsR0FDQUEsRUFBQWYiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsIFtcbiAgICAnbmdSb3V0ZSdcbl0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2YywgJGh0dHApIHsgXG4gICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS50b2tlbikgeyAvLyBEaWcgaW50byBIVE1MIDUgbG9jYWxTdG9yYWdlIGlmIGEgdXNlciBoYXMgYWxyZWFkeSBsb2dnZWQgaW5cbiAgICAgICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gbG9jYWxTdG9yYWdlLnRva2VuIC8vIC4uLiBpZiBzbywgc2V0IHRoZSBYLUF1dGggaGVhZGVyc1xuICAgICAgICAgICAgICAgICAgICBVc2VyU3ZjLmdldFVzZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIltBcHBsaWNhdGlvbkN0cmxdIGdvdCB1c2VyLnVzZXJuYW1lOiBcIiArIHVzZXIudXNlcm5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IHVzZXIgIC8vIC4uIGFuZCBnZXQgdGhlIGN1cnJlbnQgdXNlcidzIGluZm9cbiAgICAgICAgICAgICAgICAgICAgfSkgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbihfLCB1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0FwcGxpY2F0aW9uQ3RybF0gbG9naW4gZXZlbnQgZm9yOiAgICBcIiArIHVzZXIudXNlcm5hbWUpXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IHVzZXJcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IG51bGwgLy8gQ2xlYXIgY3VycmVudCB1c2VyXG4gICAgICAgICAgICAgICAgICAgIFVzZXJTdmMubG9nb3V0KCkgLy8gTWFrZSBzdXJlIEhUVFAgaGVhZGVycyBkbyBub3QgaW5jbHVkZSBKV1RcbiAgICAgICAgICAgICAgICB9IFxuICAgIH0pXG4gICAiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2YykgeyBcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsgLy8gdXBvbiBzdWNjZXNzIC4uLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5jdXJyZW50VXNlciA9IHJlc3BvbnNlIC8vIFRoaXMgYXBwcm9hY2ggd291bGQgbm90IHdvcmsgYmVjYXVzZSBMb2dpbkN0cmwgaXNuJ3Qgc2NvcGVkIGFsbCB0aGUgd2F5IG91dCB0byB0aGUgYXBwcm9wcmlhdGUgbGV2ZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHJlc3BvbnNlKSAvLyBJbnN0ZWFkLCBzZW5kIGFuIGV2ZW4gdXB3YXJkcyB0byB0aGUvYSBwYXJlbnQgY29udHJvbGxlclxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgIFxuICAgIFxuICAgIFxuIiwiLy8gTm90ZSEgQW5ndWxhci5tb2R1bGUoJ2FwcCcpLCBbXSkgc2V0dGVyIG11c3QgYmUgY2FsbGVkIGVhcmxpZXIgb25jZVxuLy8gb3RoZXJ3aXNlIHRoZSBhbmd1bGFyLm1vZHVsKCdhcHAnKSBiZWxvdyB3aWxsIGZhaWwhIFNlZSBtb2R1bGUuanMuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Bvc3RzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUG9zdFN2YykgeyAvLyBEZXBlbmRlbmN5LWluamVjdCBQb3N0U3ZjIHdoaWNoIGNvbnRhaW5zIHRoZSAkaHR0cCBkZXBlbmRlbmN5IGFsc29cbiAgICAgICAgICAgICRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wb3N0Qm9keSkge1xuICAgICAgICAgICAgICAgICAgICBQb3N0U3ZjLmNyZWF0ZSh7Ym9keTogJHNjb3BlLnBvc3RCb2R5fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIltwb3N0cy5jdHJsLmpzXSBzdWNjZXNzIHBvc3RpbmchXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpIC8vIFNlZSBiZWxvdyB0aGUgaW1wbGVtZW50YXRpb24gZm9yIFdlYlNvY2tldHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RCb2R5ID0gbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFBvc3RTdmMuZmV0Y2goKS5zdWNjZXNzKGZ1bmN0aW9uKHBvc3RzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RzID0gcG9zdHNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3QpIHsgLy8gVGhlIGxpc3RlbmVyIGZ1bmN0aW9uIGlzIG9mIHRoZSBmb3JtYXQgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7IC8vICRhcHBseSBpcyB1c2VkIHRvIGV4ZWN1dGUgYW4gZXhwcmVzc2lvbiBpbiBhbmd1bGFyIGZyb20gb3V0c2lkZSBvZiB0aGUgYW5ndWxhciBmcmFtZXdvcmtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2l0aG91dCAgdGhpcyB0aGUgVUkgd29uJ3QgdXBkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICRzY29wZS4kb24gc2hvdWxkIHRyaWdnZXIgYSBkaWdlc3QgY3ljbGUgYnV0IGl0IGlzIG5vdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBtYXkgYmUgYW4gQW5ndWxhciBidWcuXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiW3Bvc3RzLmN0cmwuanNdIG5ldyBwb3N0IVwiKVxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiW3Bvc3RzLmN0cmwuanNdIEpTT04uc3RyaW5naWZ5KHBvc3QpOiBcIiArIEpTT04uc3RyaW5naWZ5KHBvc3QpKVxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwicG9zdC51c2VyX2lkLm5hbWUgaXM6IFwiICsgcG9zdC51c2VyX2lkLnVzZXJuYW1lKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuIiwiLy8gQ29uc29saWRhdGUgYWxsIHRoZSBsb2dpYyBmb3IgcmVhZGluZyBwb3N0cyBpbnRvIG9uZSBzZXJ2aWNlLlxuLy8gSGVyZSB3ZSBjb3VsZCBhbHNvIHRha2UgY2FyZSBvZiBwYWdpbmF0aW9uLCBjYWNoaW5nLCBhdXRob3JpemF0aW9uXG4vLyBvciBldmVuIG1ha2luZyBtdWx0aXBsZSBIVFRQIGNhbGxzLlxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5zZXJ2aWNlKCdQb3N0U3ZjJywgZnVuY3Rpb24oJGh0dHApIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvcG9zdHMnKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS9wb3N0cycsIHBvc3QpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2YykgeyBcbiAgICAgICAgICAgICAgICAkc2NvcGUuY3JlYXRlVXNlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICAgICBVc2VyU3ZjLmNyZWF0ZVVzZXIodXNlcm5hbWUsIHBhc3N3b3JkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7IC8vIHVwb24gc3VjY2VzcyAuLi5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3Iuc3RhdHVzICsgXCIgXCIgKyBlcnJvci5kYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsgLy8gdXBvbiBzdWNjZXNzIC4uLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCByZXNwb25zZS5kYXRhKSAvLyBJbnN0ZWFkLCBzZW5kIGFuIGV2ZW50IHVwd2FyZHMgdG8gdGhlL2EgcGFyZW50IGNvbnRyb2xsZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4iLCIvLyBEZWZpbmUgcm91dGVzIGZvciB0aGUgYXBwLiBFYWNoIHJvdXRlIGhhcyBhIGNvbnRyb2xsZXIgYW5kIGEgdGVtcGxhdGUgVVJsIGFzc29jaWF0ZWQgd2l0aCBpdC5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKSAvLyBFbmFibGUgSFRNTDUgcHVzaHN0YXRlLiBObyBuZWVkIHRvIHVzZSBcIiNcIiBpbiB0aGUgVVJMIG9mIHRoZSBwYWdlcyBhbnltb3JlLlxuICAgICAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKCcvJywgeyBjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJyB9KVxuICAgICAgICAgICAgLndoZW4oJy9yZWdpc3RlcicsIHsgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ3RybCcsIHRlbXBsYXRlVXJsOiAncmVnaXN0ZXIuaHRtbCcgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbG9naW4nLCB7IGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnfSlcbn0pXG5cbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgICAgICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgICAgICB2YXIgc3ZjID0gdGhpc1xuICAgICAgICAgICAgc3ZjLmNyZWF0ZVVzZXIgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHt1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZH0pICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3ZjLmdldFVzZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhfSkgLy8gVGhpcyBnb2VzIG91dCB3aXRoIHRoZSBYLUF1dGggaGVhZGVyIGFzIHBlciBiZWxvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoaWNoIG1lYW5zIHRoYXQgdGhpcyBHRVQgcmVxdWVzdCB3aWxsIHJldHVybiBhIEpTT04gb2JqZWN0IHdpdGggdXNlciBpbmZvICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN2Yy5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZCAvLyBUaGUgQVBJIHJldHVybnMgYSBKV1QgKHRva2VuKSB1cG9uIHRoaXMgcmVxdWVzdFxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzdmMudG9rZW4gPSB2YWwuZGF0YSAvLyBUaGlzIHdvdWxkIHN0b3JlIHRoZSB0b2tlbiBpbiB0aGUgSmF2YVNjcmlwdCBlbnZpcm9ubWVudC4gQSBicm93c2VyIHJlZnJlc2ggd291bGQgY2F1c2UgdGhlIGxvZ2luIHRvIGNsZWFyIG91dC5cbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnRva2VuID0gdmFsLmRhdGEgLy8gLi4uIHNvIGluc3RlYWQsIGxldCdzIHNhdmUgdGhlIHRva2VuIHRvIEhUTUwgNSBsb2NhbFN0b3JhZ2UsIHRoZSBicm93c2VyJ3Mgb3duIG1lbW9yeSBzcGFjZS5cbiAgICAgICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gdmFsLmRhdGEgIC8vIFN0YXJ0IHNlbmRpbmcgdGhlIFgtQXV0aCBoZWFkZXIgd2l0aCB0aGUgSldUIGJ5IGRlZmF1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpdGggZXZlcnkgcmVxdWVzdCFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN2Yy5nZXRVc2VyKCkgLy8gVGhpcyBpcyB0aGUgcmV0dXJuIHZhbHVlIGZvciBzdmMubG9naW4gKGEgSlNPTiBvYmplY3QpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN2Yy5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddIC8vIFN0b3Agc2VuZGluZyB0aGUgSldUIG9uIEhUVFAgcmVxdWVzdHNcbiAgICAgICAgICAgICAgICBkZWxldGUgbG9jYWxTdG9yYWdlLnRva2VuIC8vIENsZWFyIHRoZSB0b2tlbiBmcm9tIEhUTUwgNSBsb2NhbFN0b3JhZ2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuIiwiLy8gUnVuIGJsb2NrcyBhcmUgdGhlIGNsb3Nlc3QgdGhpbmcgaW4gQW5ndWxhciB0byB0aGUgbWFpbiBtZXRob2QuXG4vLyBBIHJ1biBibG9jayBpcyB0aGUgY29kZSB3aGljaCBuZWVkcyB0byBydW4gdG8ga2lja3N0YXJ0IHRoZSBhcHBsaWNhdGlvbi5cbi8vIEl0IGlzIGV4ZWN1dGVkIGFmdGVyIGFsbCBvZiB0aGUgc2VydmljZXMgaGF2ZSBiZWVuIGNvbmZpZ3VyZWQgYW5kIHRoZVxuLy8gaW5qZWN0b3IgaGFzIGJlZW4gY3JlYXRlZC5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgICAgICAuc2VydmljZSgnV2ViU29ja2V0U3ZjJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3cpIHsgLy8gJHJvb3RTY29wZSBpcyBhIHNpbmdsZXRvbiBhbmQgdGhlIHBhcmVudCBvZiBlYWNoICRzY29wZSBpbmhlcml0cyBmcm9tLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9JdCBjYW4gYmUgdXNlZCB0byBzaGFyZSBnbG9iYWwgaW5mb3JtYXRpb24gdGhyb3VnaCBhbiBhcHBsaWNhdGlvbi5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVGFrZSB0aGUgaG9zdG5hbWUgb2YgdGhlIHBhZ2UgYW5kIHJlcGxhY2UgdGhlIEhUVFAvSFRUUFMgcGFydCB3aXRoIFdTL1dTU1xuICAgICAgICAgICAgZnVuY3Rpb24gd2Vic29ja2V0SG9zdCgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gXCJodHRwczpcIilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwid3NzOi8vXCIgKyAkd2luZG93LmxvY2F0aW9uLmhvc3RcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIndzOi8vXCIgKyAkd2luZG93LmxvY2F0aW9uLmhvc3RcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIGNvbm5lY3Rpb25cbiAgICAgICAgICAgIHRoaXMuY29ubmVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIHZhciB1cmwgPSAnd3M6Ly9sb2NhbGhvc3Q6MzAwMCcgLy8gSGFyZC1jb2RlZC4gTm90IGdvb2QuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1dlYnNvY2tldCBjb25uZWN0aW5nLi4uJylcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gd2Vic29ja2V0SG9zdCgpIC8vIFRoaXMgaW1wbGVtZW50YXRpb24gYWxsb3dzIHRoaXMgYXBwIHRvIGJlIG1pZ3JhdGVkIHRvIGFub3RoZXIgc2VydmVyIHdpdGhvdXQgYSBwcm9ibGVtXG4gICAgICAgICAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KHVybClcbiAgICAgICAgICAgICAgICB2YXIgc3ZjID0gdGhpc1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uKCkgeyAvLyBJbiB0aGUgZXZlbnQgb2YgdGhlIHNlcnZlciBub3QgXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc3BvbmRpbmcsIHRoaXMgd2lsbCBrZWVwIHJldHJ5aW5nIGZvcmV2ZXIgYmVjYXVzZSB0aGUgY2xvc2VcbiAgICAgICAgICAgICAgICAgICAgLy8gZXZlbnQgaXMgY2FsbGVkZCB3aGVuIGEgY29ubmVjdGlvbiBpcyB1bnN1Y2Nlc3NmdWxcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1dlYnNvY2tldCBjbG9zZWQuIFJlY29ubmVjdGluZy4uLicpXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KHN2Yy5jb25uZWN0LCAxMCoxMDAwKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3czonICsgcGF5bG9hZC50b3BpYywgcGF5bG9hZC5kYXRhKVxuICAgICAgICAgICAgICAgICAgICAvLyAkYnJvYWRjYXN0IGRpc3BhdGNoZXMgYW4gZXZlbnQgbmFtZSBkb3dud2FyZHMgdG8gYWxsIGNoaWxkIHNjb3Blc1xuICAgICAgICAgICAgICAgICAgICAvLyBhbmQgdGhlaXIgY2hpbGRyZW4pIG5vdGlmeWluZyB0aGUgcmVnaXN0ZXJlZCAkcm9vdFNjb3BlLlNjb3BlIGxpc3RlbmVycy5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBXZSBjb3VsZCBhZGQgYSBmdW5jdGlvbiB0byBQb3N0cyBDb250cm9sbGVyIGZvciBtYXJraW5nXG4gICAgICAgICAgICAvLyBwb3N0cyBhcyAndmlld2VkJyBpZiB0aGV5IGxhbmQgaW4gdGhlIGJyb3dzZXIncyB2aWV3cG9ydC4gXG4gICAgICAgICAgICAvLyBUaGF0IGluZm8gY291bGQgdGhlbiBiZSBzZW50IHRvIHRoZSBBUEkgYnkgdXNpbmcgV2ViU29ja2V0c1xuICAgICAgICAgICAgLy8gYW5kIHRoZSBmdW5jdGlvbiBiZWxvdy5cbiAgICAgICAgICAgIHRoaXMuc2VuZCA9IGZ1bmN0aW9uKHRvcGljLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeSh7dG9waWM6IHRvcGljLCBkYXRhOiBkYXRhfSlcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnNlbmQoanNvbilcbiAgICAgICAgICAgIH0gICAgICAgICAgXG4gICAgICAgIH0pLnJ1bihmdW5jdGlvbihXZWJTb2NrZXRTdmMpIHtcbiAgICAgICAgICAgIFdlYlNvY2tldFN2Yy5jb25uZWN0KClcbiAgICAgICAgfSlcbiAgICAgICAgIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
